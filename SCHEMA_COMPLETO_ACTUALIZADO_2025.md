# üìã SCHEMA COMPLETO Y ACTUALIZADO - BACKEND API
## Sistema de Gesti√≥n de Condominios

**üìÖ Generado:** Octubre 2, 2025  
**üîÑ Estado:** Completamente actualizado desde servidor en vivo  
**üìÑ Archivo:** `openapi_schema_actualizado_2025.yaml`  
**üìä Total endpoints:** 100+ endpoints documentados  

---

## üìÅ **ARCHIVOS DE SCHEMA DISPONIBLES:**

### **‚úÖ SCHEMA PRINCIPAL (M√ÅS ACTUALIZADO):**
- **üìÑ `openapi_schema_actualizado_2025.yaml`** ‚Üê **ESTE ES EL ACTUAL**
  - **üìÖ Generado:** Octubre 2, 2025
  - **üìä L√≠neas:** 6,206 l√≠neas
  - **‚úÖ Estado:** Completamente actualizado con todos los endpoints
  - **üéØ Versi√≥n:** OpenAPI 3.0.3

### **üìö ARCHIVOS ANTERIORES (Referencias):**
- **üìÑ `openapi_schema_actualizado_2025.yaml`** - ESTE ES EL ACTUAL
- **‚úÖ Archivos anteriores eliminados** - Solo mantenemos el m√°s actualizado

---

## üéØ **ENDPOINTS PRINCIPALES POR M√ìDULO:**

### **üè† 1. API GENERAL**
```yaml
GET  /api/                     # Bienvenida API
GET  /api/schema/              # Schema OpenAPI
GET  /api/schema/swagger-ui/   # Documentaci√≥n Swagger
GET  /api/schema/redoc/        # Documentaci√≥n ReDoc
```

### **üîê 2. AUTENTICACI√ìN**
```yaml
POST /api/login/               # Iniciar sesi√≥n
POST /api/logout/              # Cerrar sesi√≥n
GET  /api/usuarios/perfil/     # Perfil del usuario
```

### **üë• 3. USUARIOS**
```yaml
GET    /api/usuarios/                    # Lista usuarios
POST   /api/usuarios/                    # Crear usuario
GET    /api/usuarios/{id}/               # Detalle usuario
PUT    /api/usuarios/{id}/               # Actualizar usuario
DELETE /api/usuarios/{id}/               # Eliminar usuario
GET    /api/usuarios/perfil/             # Perfil actual
PUT    /api/usuarios/perfil/             # Actualizar perfil
POST   /api/usuarios/registrar-rostro/   # IA: Registrar rostro
POST   /api/usuarios/crear-admin/        # Crear administrador
```

### **üè¢ 4. CONDOMINIOS**
```yaml
GET    /api/condominios/        # Lista condominios
POST   /api/condominios/        # Crear condominio
GET    /api/condominios/{id}/   # Detalle condominio
PUT    /api/condominios/{id}/   # Actualizar condominio
DELETE /api/condominios/{id}/   # Eliminar condominio
```

### **üè† 5. PROPIEDADES**
```yaml
GET    /api/propiedades/        # Lista propiedades
POST   /api/propiedades/        # Crear propiedad
GET    /api/propiedades/{id}/   # Detalle propiedad
PUT    /api/propiedades/{id}/   # Actualizar propiedad
DELETE /api/propiedades/{id}/   # Eliminar propiedad
```

### **üì¢ 6. AVISOS**
```yaml
GET    /api/avisos/           # Lista avisos
POST   /api/avisos/           # Crear aviso
GET    /api/avisos/{id}/      # Detalle aviso
PUT    /api/avisos/{id}/      # Actualizar aviso
DELETE /api/avisos/{id}/      # Eliminar aviso
```

### **üí∞ 7. FINANZAS**
```yaml
# GASTOS
GET    /api/gastos/           # Lista gastos
POST   /api/gastos/           # Crear gasto
GET    /api/gastos/{id}/      # Detalle gasto
PUT    /api/gastos/{id}/      # Actualizar gasto
DELETE /api/gastos/{id}/      # Eliminar gasto

# PAGOS
GET    /api/pagos/            # Lista pagos
POST   /api/pagos/            # Crear pago
GET    /api/pagos/{id}/       # Detalle pago
PUT    /api/pagos/{id}/       # Actualizar pago
DELETE /api/pagos/{id}/       # Eliminar pago

# STRIPE (Pagos en l√≠nea)
POST   /api/create-payment-intent/     # Crear intenci√≥n de pago
POST   /api/stripe-webhook/            # Webhook de Stripe
```

### **üõ°Ô∏è 8. SEGURIDAD**
```yaml
# CONTROL DE ACCESO
GET    /api/controles-acceso/              # Lista controles
POST   /api/controles-acceso/              # Registrar acceso
GET    /api/controles-acceso/{id}/         # Detalle control
PUT    /api/controles-acceso/{id}/         # Actualizar control
DELETE /api/controles-acceso/{id}/         # Eliminar control

# VISITANTES
GET    /api/visitantes/                    # Lista visitantes
POST   /api/visitantes/                    # Registrar visitante
GET    /api/visitantes/{id}/               # Detalle visitante
PUT    /api/visitantes/{id}/               # Actualizar visitante
DELETE /api/visitantes/{id}/               # Eliminar visitante

# VISITAS ABIERTAS (IA)
GET    /api/visitas-abiertas/              # Visitas sin cerrar

# ALERTAS DE SEGURIDAD
GET    /api/alertas-seguridad/             # Lista alertas
POST   /api/alertas-seguridad/             # Crear alerta
GET    /api/alertas-seguridad/{id}/        # Detalle alerta
PUT    /api/alertas-seguridad/{id}/        # Actualizar alerta
DELETE /api/alertas-seguridad/{id}/        # Eliminar alerta
```

### **üîß 9. MANTENIMIENTO**
```yaml
# TICKETS
GET    /api/tickets/          # Lista tickets
POST   /api/tickets/          # Crear ticket
GET    /api/tickets/{id}/     # Detalle ticket
PUT    /api/tickets/{id}/     # Actualizar ticket
DELETE /api/tickets/{id}/     # Eliminar ticket

# ASIGNACIONES
GET    /api/asignaciones/     # Lista asignaciones
POST   /api/asignaciones/     # Crear asignaci√≥n
GET    /api/asignaciones/{id}/ # Detalle asignaci√≥n
PUT    /api/asignaciones/{id}/ # Actualizar asignaci√≥n
DELETE /api/asignaciones/{id}/ # Eliminar asignaci√≥n
```

### **üìä 10. AUDITOR√çA**
```yaml
GET    /api/auditoria/bitacora/     # Lista bit√°cora
GET    /api/auditoria/bitacora/{id}/ # Detalle registro
```

### **üì± 11. NOTIFICACIONES**
```yaml
GET    /api/notificaciones/          # Lista notificaciones
POST   /api/notificaciones/          # Crear notificaci√≥n
GET    /api/notificaciones/{id}/     # Detalle notificaci√≥n
PUT    /api/notificaciones/{id}/     # Actualizar notificaci√≥n
DELETE /api/notificaciones/{id}/     # Eliminar notificaci√≥n

# DISPOSITIVOS FCM
GET    /api/dispositivos-fcm/        # Lista dispositivos
POST   /api/dispositivos-fcm/        # Registrar dispositivo
GET    /api/dispositivos-fcm/{id}/   # Detalle dispositivo
PUT    /api/dispositivos-fcm/{id}/   # Actualizar dispositivo
DELETE /api/dispositivos-fcm/{id}/   # Eliminar dispositivo
```

---

## üîç **FILTROS AVANZADOS EN TODOS LOS ENDPOINTS:**

### **üéØ Filtros Disponibles:**
```yaml
# FILTROS DE CAMPO
campo=valor                    # Filtro exacto
campo__icontains=texto        # Contiene texto (insensible a may√∫sculas)
campo__gte=valor              # Mayor o igual que
campo__lte=valor              # Menor o igual que
campo__in=valor1,valor2       # En lista de valores

# B√öSQUEDA DE TEXTO
search=t√©rmino                # B√∫squeda en campos de texto

# ORDENAMIENTO
ordering=campo                # Ascendente
ordering=-campo               # Descendente

# EJEMPLOS PR√ÅCTICOS
/api/usuarios/?search=juan
/api/gastos/?fecha__gte=2025-01-01&fecha__lte=2025-12-31
/api/controles-acceso/?tipo=INGRESO&ordering=-timestamp
/api/pagos/?estado=COMPLETADO&monto__gte=100
```

### **üìã Campos Filtrables por Endpoint:**

#### **üë• Usuarios:**
```yaml
username__icontains, email__icontains, first_name__icontains,
last_name__icontains, is_active, date_joined__gte, date_joined__lte
```

#### **üí∞ Finanzas:**
```yaml
# Gastos: descripcion__icontains, categoria, monto__gte, monto__lte,
#         fecha__gte, fecha__lte, condominio
# Pagos:  concepto__icontains, monto__gte, monto__lte, estado,
#         fecha_pago__gte, fecha_pago__lte, propiedad, usuario
```

#### **üõ°Ô∏è Seguridad:**
```yaml
# Control Acceso: tipo, placa__icontains, timestamp__gte, timestamp__lte,
#                 usuario, condominio
# Visitantes:     nombre__icontains, documento__icontains, telefono,
#                 fecha_visita__gte, fecha_visita__lte, propiedad_visitada
```

#### **üîß Mantenimiento:**
```yaml
# Tickets: titulo__icontains, descripcion__icontains, estado, prioridad,
#          fecha_creacion__gte, fecha_creacion__lte, categoria, asignado_a
```

---

## üéØ **AUTENTICACI√ìN Y PERMISOS:**

### **üîê M√©todos de Autenticaci√≥n:**
```yaml
# TOKEN AUTHENTICATION (Principal)
Authorization: Token <tu-token-aqu√≠>

# SESSION AUTHENTICATION (Para Swagger UI)
Cookie: sessionid=<session-id>

# Obtener Token
POST /api/login/
{
  "username": "admin",
  "password": "admin123"
}
# Respuesta: {"token": "589db8d96d1dfbd4eeac58d784ad7b3989a0bb21"}
```

### **üë§ Roles y Permisos:**
```yaml
PROPIETARIO:    # Acceso completo a todos los endpoints
RESIDENTE:      # Acceso limitado a sus propias finanzas y avisos
SEGURIDAD:      # Acceso a control de acceso y seguridad
MANTENIMIENTO:  # Acceso a tickets de mantenimiento
```

---

## üìä **MODELOS DE DATOS PRINCIPALES:**

### **üë§ Usuario:**
```yaml
User:
  id: integer
  username: string
  email: string
  first_name: string
  last_name: string
  is_active: boolean
  date_joined: datetime

UserProfile:
  user: User
  role: string [PROPIETARIO, RESIDENTE, SEGURIDAD, MANTENIMIENTO]
  especialidad: string (opcional)
  telefono: string
  foto: file
```

### **üè¢ Condominio:**
```yaml
Condominio:
  id: integer
  nombre: string
  direccion: string
  telefono: string
  email: string
  administrador: User
  fecha_creacion: datetime
```

### **üè† Propiedad:**
```yaml
Propiedad:
  id: integer
  numero: string
  tipo: string [APARTAMENTO, CASA, OFICINA, LOCAL]
  condominio: Condominio
  propietario: User
  inquilino: User (opcional)
  area: decimal
  valor_catastral: decimal
```

### **üí∞ Finanzas:**
```yaml
Gasto:
  id: integer
  descripcion: string
  categoria: string
  monto: decimal
  fecha: date
  condominio: Condominio
  creado_por: User

Pago:
  id: integer
  concepto: string
  monto: decimal
  estado: string [PENDIENTE, COMPLETADO, CANCELADO]
  fecha_pago: datetime
  propiedad: Propiedad
  usuario: User
  stripe_payment_intent_id: string (opcional)
```

### **üõ°Ô∏è Seguridad:**
```yaml
ControlAcceso:
  id: integer
  tipo: string [INGRESO, SALIDA]
  placa: string (opcional)
  timestamp: datetime
  usuario: User (opcional)
  condominio: Condominio
  observaciones: text

Visitante:
  id: integer
  nombre: string
  documento: string
  telefono: string
  fecha_visita: datetime
  motivo: string
  propiedad_visitada: Propiedad
  autorizado_por: User
  foto: file (opcional)
```

### **üîß Mantenimiento:**
```yaml
Ticket:
  id: integer
  titulo: string
  descripcion: text
  estado: string [ABIERTO, EN_PROGRESO, RESUELTO, CERRADO]
  prioridad: string [BAJA, MEDIA, ALTA, URGENTE]
  categoria: string
  fecha_creacion: datetime
  fecha_resolucion: datetime (opcional)
  creado_por: User
  asignado_a: User (opcional)
  condominio: Condominio
```

---

## üöÄ **ENDPOINTS DE INTELIGENCIA ARTIFICIAL:**

### **üéØ IA Integrada en el Sistema:**
```yaml
# RECONOCIMIENTO FACIAL
POST /api/usuarios/registrar-rostro/
# Registra rostro en AWS Rekognition

# CONTROL DE ACCESO AUTOM√ÅTICO
POST /api/controles-acceso/
# Puede usar reconocimiento facial para autorizar acceso

# DETECCI√ìN DE VISITANTES
GET /api/visitas-abiertas/
# Lista visitantes que no han registrado salida

# ALERTAS AUTOM√ÅTICAS
GET /api/alertas-seguridad/
# Alertas generadas por IA (comportamiento sospechoso, etc.)
```

### **üîß Configuraci√≥n IA:**
```yaml
# En settings.py
AWS_REKOGNITION_COLLECTION_ID = "condominio_residentes"
SECURITY_API_KEY = "MI_CLAVE_SUPER_SECRETA_12345"

# Headers especiales para IA
X-API-KEY: MI_CLAVE_SUPER_SECRETA_12345  # Para c√°maras de IA
```

---

## üì± **EJEMPLO DE USO COMPLETO:**

### **üîê 1. Autenticaci√≥n:**
```bash
curl -X POST http://127.0.0.1:8000/api/login/ \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'

# Respuesta: {"token":"589db8d96d1dfbd4eeac58d784ad7b3989a0bb21"}
```

### **üë• 2. Obtener Usuarios:**
```bash
curl -H "Authorization: Token 589db8d96d1dfbd4eeac58d784ad7b3989a0bb21" \
  http://127.0.0.1:8000/api/usuarios/
```

### **üè† 3. Crear Propiedad:**
```bash
curl -X POST http://127.0.0.1:8000/api/propiedades/ \
  -H "Authorization: Token 589db8d96d1dfbd4eeac58d784ad7b3989a0bb21" \
  -H "Content-Type: application/json" \
  -d '{
    "numero": "101",
    "tipo": "APARTAMENTO",
    "condominio": 1,
    "propietario": 2,
    "area": 75.5,
    "valor_catastral": 50000
  }'
```

### **üí∞ 4. Registrar Pago:**
```bash
curl -X POST http://127.0.0.1:8000/api/pagos/ \
  -H "Authorization: Token 589db8d96d1dfbd4eeac58d784ad7b3989a0bb21" \
  -H "Content-Type: application/json" \
  -d '{
    "concepto": "Cuota mensual",
    "monto": 150.00,
    "estado": "COMPLETADO",
    "propiedad": 1,
    "usuario": 2
  }'
```

### **üõ°Ô∏è 5. Control de Acceso:**
```bash
curl -X POST http://127.0.0.1:8000/api/controles-acceso/ \
  -H "Authorization: Token 589db8d96d1dfbd4eeac58d784ad7b3989a0bb21" \
  -H "Content-Type: application/json" \
  -d '{
    "tipo": "INGRESO",
    "placa": "ABC123",
    "usuario": 2,
    "condominio": 1,
    "observaciones": "Ingreso autorizado"
  }'
```

---

## üìã **RESUMEN EJECUTIVO:**

### **‚úÖ Schema Completamente Actualizado:**
- **üìÑ Archivo:** `openapi_schema_actualizado_2025.yaml`
- **üìä Total l√≠neas:** 6,206 l√≠neas
- **üéØ Endpoints:** 100+ endpoints documentados
- **üìÖ Fecha:** Octubre 2, 2025
- **‚úÖ Estado:** Generado desde servidor en vivo

### **üéØ M√≥dulos Incluidos:**
- ‚úÖ **Autenticaci√≥n y Usuarios** (10+ endpoints)
- ‚úÖ **Condominios y Propiedades** (10+ endpoints)
- ‚úÖ **Finanzas Completas** (15+ endpoints)
- ‚úÖ **Seguridad con IA** (20+ endpoints)
- ‚úÖ **Mantenimiento** (10+ endpoints)
- ‚úÖ **Auditor√≠a** (5+ endpoints)
- ‚úÖ **Notificaciones** (10+ endpoints)
- ‚úÖ **Comunicaci√≥n** (5+ endpoints)

### **üîß Caracter√≠sticas T√©cnicas:**
- ‚úÖ **OpenAPI 3.0.3** est√°ndar
- ‚úÖ **Filtros avanzados** en todos los endpoints
- ‚úÖ **Autenticaci√≥n por tokens** implementada
- ‚úÖ **Permisos por roles** configurados
- ‚úÖ **Integraci√≥n IA** documentada
- ‚úÖ **CORS configurado** para frontend web
- ‚úÖ **Documentaci√≥n Swagger/ReDoc** disponible

**üéâ Este es el schema m√°s completo y actualizado del sistema!**